insert into table choco_data.ams_imprsn_diff_tmp
select ams.imprsn_cntnr_id,ams.imprsn_dt
FROM (select * from choco_data.ams_imprsn_v2 where imprsn_dt='#{imprsn_dt}' and imprsn_cntnr_id is not  null) new
    FULL outer join (select * from choco_data.ams_imprsn where imprsn_dt='#{imprsn_dt}' and imprsn_cntnr_id is not  null) ams
on  ams.imprsn_cntnr_id = new.imprsn_cntnr_id where  !(
    ams.imprsn_cntnr_id          <=>     new.imprsn_cntnr_id          and
    ams.file_schm_vrsn_num       <=>     new.file_schm_vrsn_num       and
    ams.file_id                  <=>     new.file_id                  and
    ams.batch_id                 <=>     new.batch_id                 and
    ams.chnl_id                  <=>     new.chnl_id                  and
    ams.crltn_guid_txt           <=>     new.crltn_guid_txt           and
    ams.guid_txt                 <=>     new.guid_txt                 and
    ams.user_id                  <=>     new.user_id                  and
    ams.clnt_rmt_ip              <=>     new.clnt_rmt_ip              and
    ams.brwsr_type_num           <=>     new.brwsr_type_num           and
    ams.brwsr_name               <=>     new.brwsr_name               and
    ams.rfr_url_name             <=>     new.rfr_url_name             and
    ams.prvs_rfr_dmn_name        <=>     new.prvs_rfr_dmn_name        and
    ams.user_query_txt           <=>     new.user_query_txt           and
    ams.plcmnt_data_txt          <=>     new.plcmnt_data_txt          and
    ams.pblshr_id                <=>     new.pblshr_id                and
    ams.ams_pblshr_cmpgn_id      <=>     new.ams_pblshr_cmpgn_id      and
    ams.ams_tool_id              <=>     new.ams_tool_id              and
    ams.cstm_id                  <=>     new.cstm_id                  and
    ams.flex_fld_vrsn_num        <=>     new.flex_fld_vrsn_num        and
    ams.flex_fld_1_txt           <=>     new.flex_fld_1_txt           and
    ams.flex_fld_2_txt           <=>     new.flex_fld_2_txt           and
    ams.flex_fld_3_txt           <=>     new.flex_fld_3_txt           and
    ams.flex_fld_4_txt           <=>     new.flex_fld_4_txt           and
    ams.flex_fld_5_txt           <=>     new.flex_fld_5_txt           and
    ams.flex_fld_6_txt           <=>     new.flex_fld_6_txt           and
    ams.flex_fld_7_txt           <=>     new.flex_fld_7_txt           and
    ams.flex_fld_8_txt           <=>     new.flex_fld_8_txt           and
    ams.flex_fld_9_txt           <=>     new.flex_fld_9_txt           and
    ams.flex_fld_10_txt          <=>     new.flex_fld_10_txt          and
    ams.flex_fld_11_txt          <=>     new.flex_fld_11_txt          and
    ams.flex_fld_12_txt          <=>     new.flex_fld_12_txt          and
    ams.flex_fld_13_txt          <=>     new.flex_fld_13_txt          and
    ams.flex_fld_14_txt          <=>     new.flex_fld_14_txt          and
    ams.flex_fld_15_txt          <=>     new.flex_fld_15_txt          and
    ams.flex_fld_16_txt          <=>     new.flex_fld_16_txt          and
    ams.flex_fld_17_txt          <=>     new.flex_fld_17_txt          and
    ams.flex_fld_18_txt          <=>     new.flex_fld_18_txt          and
    ams.flex_fld_19_txt          <=>     new.flex_fld_19_txt          and
    ams.flex_fld_20_txt          <=>     new.flex_fld_20_txt          and
    ams.ctx_txt                  <=>     new.ctx_txt                  and
    ams.ctx_cld_txt              <=>     new.ctx_cld_txt              and
    ams.ctx_rslt_txt             <=>     new.ctx_rslt_txt             and
    ams.rfr_dmn_name             <=>     new.rfr_dmn_name             and
    ams.imprsn_ts                <=>     new.imprsn_ts                and
    ams.ams_prgrm_id             <=>     new.ams_prgrm_id             and
    ams.advrtsr_id               <=>     new.advrtsr_id               and
    ams.ams_click_fltr_type_id   <=>     new.ams_click_fltr_type_id   and
    ams.filter_yn_ind            <=>     new.filter_yn_ind            and
    ams.rover_url_txt            <=>     new.rover_url_txt            and
    ams.mplx_timeout_flag        <=>     new.mplx_timeout_flag        and
    ams.cb_kw                    <=>     new.cb_kw                    and
    ams.cb_cat                   <=>     new.cb_cat                   and
    ams.cb_ex_kw                 <=>     new.cb_ex_kw                 and
    ams.cb_ex_cat                <=>     new.cb_ex_cat                and
    ams.fb_used                  <=>     new.fb_used                  and
    ams.ad_format                <=>     new.ad_format                and
    ams.ad_content_type          <=>     new.ad_content_type          and
    ams.load_time                <=>     new.load_time                and
    ams.app_id                   <=>     new.app_id                   and
    ams.app_package_name         <=>     new.app_package_name         and
    ams.app_name                 <=>     new.app_name                 and
    ams.app_version              <=>     new.app_version              and
    ams.device_name              <=>     new.device_name              and
    ams.os_name                  <=>     new.os_name                  and
    ams.os_version               <=>     new.os_version               and
    ams.udid                     <=>     new.udid                     and
    ams.sdk_name                 <=>     new.sdk_name                 and
    ams.sdk_version              <=>     new.sdk_version              and
    ams.ams_trans_rsn_cd         <=>     new.ams_trans_rsn_cd         and
    ams.trfc_src_cd              <=>     new.trfc_src_cd              and
    ams.rt_rule_flag1            <=>     new.rt_rule_flag1            and
    ams.rt_rule_flag2            <=>     new.rt_rule_flag2            and
    ams.rt_rule_flag3            <=>     new.rt_rule_flag3            and
    ams.rt_rule_flag4            <=>     new.rt_rule_flag4            and
    ams.rt_rule_flag5            <=>     new.rt_rule_flag5            and
    ams.rt_rule_flag6            <=>     new.rt_rule_flag6            and
    ams.rt_rule_flag7            <=>     new.rt_rule_flag7            and
    ams.rt_rule_flag8            <=>     new.rt_rule_flag8            and
    ams.rt_rule_flag9            <=>     new.rt_rule_flag9            and
    ams.rt_rule_flag10           <=>     new.rt_rule_flag10           and
    ams.rt_rule_flag11           <=>     new.rt_rule_flag11           and
    ams.rt_rule_flag12           <=>     new.rt_rule_flag12           and
    ams.rt_rule_flag13           <=>     new.rt_rule_flag13           and
    ams.rt_rule_flag14           <=>     new.rt_rule_flag14           and
    ams.rt_rule_flag15           <=>     new.rt_rule_flag15           and
    ams.rt_rule_flag16           <=>     new.rt_rule_flag16           and
    ams.rt_rule_flag17           <=>     new.rt_rule_flag17           and
    ams.rt_rule_flag18           <=>     new.rt_rule_flag18           and
    ams.rt_rule_flag19           <=>     new.rt_rule_flag19           and
    ams.rt_rule_flag20           <=>     new.rt_rule_flag20           and
    ams.rt_rule_flag21           <=>     new.rt_rule_flag21           and
    ams.rt_rule_flag22           <=>     new.rt_rule_flag22           and
    ams.rt_rule_flag23           <=>     new.rt_rule_flag23           and
    ams.rt_rule_flag24           <=>     new.rt_rule_flag24           and
    ams.nrt_rule_flag1           <=>     new.nrt_rule_flag1           and
    ams.nrt_rule_flag2           <=>     new.nrt_rule_flag2           and
    ams.nrt_rule_flag3           <=>     new.nrt_rule_flag3           and
    ams.nrt_rule_flag4           <=>     new.nrt_rule_flag4           and
    ams.nrt_rule_flag5           <=>     new.nrt_rule_flag5           and
    ams.nrt_rule_flag6           <=>     new.nrt_rule_flag6           and
    ams.nrt_rule_flag7           <=>     new.nrt_rule_flag7           and
    ams.nrt_rule_flag8           <=>     new.nrt_rule_flag8           and
    ams.nrt_rule_flag9           <=>     new.nrt_rule_flag9           and
    ams.nrt_rule_flag10          <=>     new.nrt_rule_flag10          and
    ams.nrt_rule_flag11          <=>     new.nrt_rule_flag11          and
    ams.nrt_rule_flag12          <=>     new.nrt_rule_flag12          and
    ams.nrt_rule_flag13          <=>     new.nrt_rule_flag13          and
    ams.nrt_rule_flag14          <=>     new.nrt_rule_flag14          and
    ams.nrt_rule_flag15          <=>     new.nrt_rule_flag15          and
    ams.nrt_rule_flag16          <=>     new.nrt_rule_flag16          and
    ams.nrt_rule_flag17          <=>     new.nrt_rule_flag17          and
    ams.nrt_rule_flag18          <=>     new.nrt_rule_flag18          and
    ams.nrt_rule_flag19          <=>     new.nrt_rule_flag19          and
    ams.nrt_rule_flag20          <=>     new.nrt_rule_flag20          and
    ams.nrt_rule_flag21          <=>     new.nrt_rule_flag21          and
    ams.nrt_rule_flag22          <=>     new.nrt_rule_flag22          and
    ams.nrt_rule_flag23          <=>     new.nrt_rule_flag23          and
    ams.nrt_rule_flag24          <=>     new.nrt_rule_flag24          and
    ams.nrt_rule_flag25          <=>     new.nrt_rule_flag25          and
    ams.nrt_rule_flag26          <=>     new.nrt_rule_flag26          and
    ams.nrt_rule_flag27          <=>     new.nrt_rule_flag27          and
    ams.nrt_rule_flag28          <=>     new.nrt_rule_flag28          and
    ams.nrt_rule_flag29          <=>     new.nrt_rule_flag29          and
    ams.nrt_rule_flag30          <=>     new.nrt_rule_flag30          and
    ams.nrt_rule_flag31          <=>     new.nrt_rule_flag31          and
    ams.nrt_rule_flag32          <=>     new.nrt_rule_flag32          and
    ams.nrt_rule_flag33          <=>     new.nrt_rule_flag33          and
    ams.nrt_rule_flag34          <=>     new.nrt_rule_flag34          and
    ams.nrt_rule_flag35          <=>     new.nrt_rule_flag35          and
    ams.nrt_rule_flag36          <=>     new.nrt_rule_flag36          and
    ams.nrt_rule_flag37          <=>     new.nrt_rule_flag37          and
    ams.nrt_rule_flag38          <=>     new.nrt_rule_flag38          and
    ams.nrt_rule_flag39          <=>     new.nrt_rule_flag39          and
    ams.nrt_rule_flag40          <=>     new.nrt_rule_flag40          and
    ams.nrt_rule_flag41          <=>     new.nrt_rule_flag41          and
    ams.nrt_rule_flag42          <=>     new.nrt_rule_flag42          and
    ams.nrt_rule_flag43          <=>     new.nrt_rule_flag43          and
    ams.nrt_rule_flag44          <=>     new.nrt_rule_flag44          and
    ams.nrt_rule_flag45          <=>     new.nrt_rule_flag45          and
    ams.nrt_rule_flag46          <=>     new.nrt_rule_flag46          and
    ams.nrt_rule_flag47          <=>     new.nrt_rule_flag47          and
    ams.nrt_rule_flag48          <=>     new.nrt_rule_flag48          and
    ams.nrt_rule_flag49          <=>     new.nrt_rule_flag49          and
    ams.nrt_rule_flag50          <=>     new.nrt_rule_flag50          and
    ams.nrt_rule_flag51          <=>     new.nrt_rule_flag51          and
    ams.nrt_rule_flag51          <=>     new.nrt_rule_flag51          and
    ams.nrt_rule_flag52          <=>     new.nrt_rule_flag52          and
    ams.nrt_rule_flag53          <=>     new.nrt_rule_flag53          and
    ams.nrt_rule_flag54          <=>     new.nrt_rule_flag54          and
    ams.nrt_rule_flag55          <=>     new.nrt_rule_flag55          and
    ams.nrt_rule_flag56          <=>     new.nrt_rule_flag56          and
    ams.nrt_rule_flag57          <=>     new.nrt_rule_flag57          and
    ams.nrt_rule_flag58          <=>     new.nrt_rule_flag58          and
    ams.nrt_rule_flag59          <=>     new.nrt_rule_flag59          and
    ams.nrt_rule_flag60          <=>     new.nrt_rule_flag60          and
    ams.nrt_rule_flag61          <=>     new.nrt_rule_flag61          and
    ams.nrt_rule_flag62          <=>     new.nrt_rule_flag62          and
    ams.nrt_rule_flag63          <=>     new.nrt_rule_flag63          and
    ams.nrt_rule_flag64          <=>     new.nrt_rule_flag64          and
    ams.nrt_rule_flag65          <=>     new.nrt_rule_flag65          and
    ams.nrt_rule_flag66          <=>     new.nrt_rule_flag66          and
    ams.nrt_rule_flag67          <=>     new.nrt_rule_flag67          and
    ams.nrt_rule_flag68          <=>     new.nrt_rule_flag68          and
    ams.nrt_rule_flag69          <=>     new.nrt_rule_flag69          and
    ams.nrt_rule_flag70          <=>     new.nrt_rule_flag70          and
    ams.nrt_rule_flag71          <=>     new.nrt_rule_flag71          and
    ams.nrt_rule_flag72          <=>     new.nrt_rule_flag72          and
    new.imprsn_cntnr_id is not null and ams.imprsn_cntnr_id is not null)
UNION
select null as imprsn_cntnr_id,'#{imprsn_dt}' as imprsn_dt
where (select count(*) as count from choco_data.ams_imprsn_v2 where imprsn_dt='#{imprsn_dt}' and imprsn_cntnr_id is null) <>
      (select count(*) as count from choco_data.ams_imprsn where imprsn_dt='#{imprsn_dt}' and imprsn_cntnr_id is null)